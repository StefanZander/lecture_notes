
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>AsyncTask - Android & Android Studio</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400,400i,700%7CRoboto+mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto Condensed";--md-code-font-family:"Roboto mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="red">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#asynctask-concurrent-programming-in-android" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Android &amp; Android Studio" class="md-header__button md-logo" aria-label="Android & Android Studio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Android & Android Studio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AsyncTask
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Android &amp; Android Studio" class="md-nav__button md-logo" aria-label="Android & Android Studio" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Android & Android Studio
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Index
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../generics/" class="md-nav__link">
        Collections und Generics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../serialisierung/" class="md-nav__link">
        Serialisierung und Persistenz
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../singleton/" class="md-nav__link">
        Singleton
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../serialized_singleton/" class="md-nav__link">
        Serialized Singleton
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../grundlagen/" class="md-nav__link">
        Grundlagen
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../activities/" class="md-nav__link">
        Activities & Intents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../handler/" class="md-nav__link">
        Handler
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../json/" class="md-nav__link">
        JSON
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data_storage/" class="md-nav__link">
        Data Storage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../actionbar/" class="md-nav__link">
        App Bar
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../recycler_view/" class="md-nav__link">
        RecyclerView
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          AsyncTask
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        AsyncTask
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canceling-a-task" class="md-nav__link">
    Canceling a Task
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threading-rules" class="md-nav__link">
    Threading Rules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-subclassing-asynctask" class="md-nav__link">
    Example #1: Subclassing AsyncTask
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-passing-runnable-to-asynctasks-execute-method" class="md-nav__link">
    Example #2: Passing Runnable to AsyncTask's execute Method
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-you-have-learned" class="md-nav__link">
    What you have Learned
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disclaimer" class="md-nav__link">
    Disclaimer
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../thread_communication/" class="md-nav__link">
        Threads & Communication
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    Structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canceling-a-task" class="md-nav__link">
    Canceling a Task
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threading-rules" class="md-nav__link">
    Threading Rules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-subclassing-asynctask" class="md-nav__link">
    Example #1: Subclassing AsyncTask
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-passing-runnable-to-asynctasks-execute-method" class="md-nav__link">
    Example #2: Passing Runnable to AsyncTask's execute Method
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-you-have-learned" class="md-nav__link">
    What you have Learned
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disclaimer" class="md-nav__link">
    Disclaimer
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="asynctask-concurrent-programming-in-android">AsyncTask: Concurrent Programming in Android</h1>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p><strong>Objectives</strong></p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> You know the basic constituents of Android&rsquo;s AsyncTask</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> You know how to subclass the AsyncTask class</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> You can use AsyncTask to outsource computationally extensive tasks from the UI thread</li>
</ul>
</div>
<h2 id="introduction">Introduction</h2>
<p>AsyncTask enables to keep the UI thread from having to perform computational expensive operations. 
This class allows you to <strong>perform background operations</strong> asynchronously and publish results on the UI thread without having to manipulate threads and/or handlers.</p>
<p>AsyncTask is designed to be a <strong>helper class</strong> around <code>Thread</code> and <code>Handler</code> and does <em>not</em> constitute a generic threading framework. 
AsyncTasks should ideally be used for <strong>short operations</strong> (a few seconds at the most). </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Use a Threading Framework for Long-Running Operations</strong><br />
If you need to keep threads running for long periods of time, it is highly recommended you use the various APIs provided by the <code>java.util.concurrent</code> package such as <a href="https://developer.android.com/reference/java/util/concurrent/Executor.html">Executor</a>, <a href="https://developer.android.com/reference/java/util/concurrent/ThreadPoolExecutor.html">ThreadPoolExecutor</a> and <a href="https://developer.android.com/reference/java/util/concurrent/FutureTask.html">FutureTask</a>.</p>
</div>
<h2 id="structure">Structure</h2>
<!-- An asynchronous task is defined by a **computation** that runs on a **background thread** and whose result is **published on the UI thread**.  -->

<p>An asynchronous task is defined by <strong>3 generic types</strong>: </p>
<ul>
<li><code>Params</code> – the type of the parameters sent to the task upon execution.</li>
<li><code>Progress</code> – the type of the progress units published during the background computation. </li>
<li><code>Result</code> – the type of the result of the background computation.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Set Unused Types to <code>Void</code></strong>
Not all types are always used by an asynchronous task. To mark a type as unused, simply use the type <code>Void</code>:</p>
<p><code class="highlight"><span class="kr">private</span> <span class="kr">class</span> <span class="nx">MyTask</span> <span class="kr">extends</span> <span class="nx">AsyncTask</span><span class="o">&lt;</span><span class="nx">Void</span><span class="p">,</span> <span class="nx">Void</span><span class="p">,</span> <span class="nx">Void</span><span class="o">&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span></code></p>
</div>
<p>An asynchronous task defines <strong>4 callback methods</strong> (=<em>steps</em>); when an asynchronous task is executed, the task goes through the following steps</p>
<ol>
<li>
<p><code class="highlight"><span class="nx">onPreExecute</span><span class="p">()</span></code>  invoked on the <em>UI thread</em> before the task is executed. This step is normally used to setup the task, for instance, by showing a progress bar in the UI.</p>
</li>
<li>
<p><code class="highlight"><span class="nx">doInBackground</span><span class="p">(</span><span class="nx">Params</span><span class="p">...)</span></code> invoked on the <em>background thread</em> immediately after <code class="highlight"><span class="nx">onPreExecute</span><span class="p">()</span></code> finished execution. This step is used to perform background computation that can take a long time. The <code>Params</code> parameters of the asynchronous task are passed to this step. The result of the computation must be returned by this step and will be passed to <code class="highlight"><span class="nx">onPostExecute</span><span class="p">(</span><span class="nx">Result</span><span class="p">)</span></code>. This step can also use <code class="highlight"><span class="nx">publishProgress</span><span class="p">(</span><span class="nx">Progress</span><span class="p">...)</span></code> to publish one or more units of progress. These values are published on the UI thread, in the <code class="highlight"><span class="nx">onProgressUpdate</span><span class="p">(</span><span class="nx">Progress</span><span class="p">...)</span></code> step.</p>
</li>
<li>
<p><code class="highlight"><span class="nx">onProgressUpdate</span><span class="p">(</span><span class="nx">Progress</span><span class="p">...)</span></code> invoked on the <em>UI thread</em> after a call to <code class="highlight"><span class="nx">publishProgress</span><span class="p">(</span><span class="nx">Progress</span><span class="p">...)</span></code>. The timing of the execution is undefined. This method is used to display any form of progress in the user interface while the background computation is still executing. For instance, it can be used to animate a progress bar or show logs in a text field. </p>
</li>
<li>
<p><code class="highlight"><span class="nx">onPostExecute</span><span class="p">(</span><span class="nx">Result</span><span class="p">)</span></code> invoked on the <em>UI thread</em> after the background computation finishes. The result of the background computation is passed to this callback method as a parameter.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Pay Attention to where a Method is Executed</strong><br />
Please pay close attention to which methods are exectuted by the <strong>UI thread</strong> and which by the <strong>background thread</strong>. This distinction is important as UI elements (=<em>views defined in the activity&rsquo;s layout</em>) can only by manipulated by the UI thread. Trying to manipulate them from a method executed by the background thread will result in an exception and termination.</p>
</div>
<h2 id="usage">Usage</h2>
<p>AsyncTask must be <strong>subclassed</strong> to be used. 
The subclass will override at least one method (<code class="highlight"><span class="nx">doInBackground</span><span class="p">(</span><span class="nx">Params</span><span class="p">...)</span></code>), and most often will override a second one (<code class="highlight"><span class="nx">onPostExecute</span><span class="p">(</span><span class="nx">Result</span><span class="p">)</span></code>).</p>
<p>The following example from the <a href="https://developer.android.com/reference/android/os/AsyncTask">official documentation</a> demonstrates the usage of AsyncTask:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="kd">class</span> <span class="nc">DownloadFilesTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">URL</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">protected</span> <span class="n">Long</span> <span class="nf">doInBackground</span><span class="p">(</span><span class="n">URL</span><span class="p">...</span> <span class="n">urls</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">urls</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
        <span class="kt">long</span> <span class="n">totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">totalSize</span> <span class="o">+=</span> <span class="n">Downloader</span><span class="p">.</span><span class="na">downloadFile</span><span class="p">(</span><span class="n">urls</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
            <span class="n">publishProgress</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">));</span>
            <span class="c1">// Escape early if cancel() is called</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isCancelled</span><span class="p">())</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">totalSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onProgressUpdate</span><span class="p">(</span><span class="n">Integer</span><span class="p">...</span> <span class="n">progress</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">setProgressPercent</span><span class="p">(</span><span class="n">progress</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="p">(</span><span class="n">Long</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">showDialog</span><span class="p">(</span><span class="s">&quot;Downloaded &quot;</span> <span class="o">+</span> <span class="n">result</span> <span class="o">+</span> <span class="s">&quot; bytes&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Once created, an instance of the task can be created and executed rather simply:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">new</span> <span class="n">DownloadFilesTask</span><span class="p">().</span><span class="na">execute</span><span class="p">(</span><span class="n">url1</span><span class="p">,</span> <span class="n">url2</span><span class="p">,</span> <span class="n">url3</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

<h2 id="canceling-a-task">Canceling a Task</h2>
<p>A task can be cancelled at any time by invoking <code class="highlight"><span class="nx">cancel</span><span class="p">(</span><span class="kr">boolean</span><span class="p">)</span></code>. Invoking this method will cause subsequent calls to <code class="highlight"><span class="nx">isCancelled</span><span class="p">()</span></code> to return true. After invoking this method, <code class="highlight"><span class="nx">onCancelled</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nb">Object</span><span class="p">)</span></code>, instead of <code class="highlight"><span class="nx">onPostExecute</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nb">Object</span><span class="p">)</span></code> will be invoked after <code class="highlight"><span class="nx">doInBackground</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nb">Object</span><span class="p">[]</span></code> returns. To ensure that a task is cancelled as quickly as possible, you should always check the return value of <code class="highlight"><span class="nx">isCancelled</span><span class="p">()</span></code> periodically from <code class="highlight"><span class="nx">doInBackground</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nb">Object</span><span class="p">[])</span></code>, if possible (inside a loop for instance.)</p>
<h2 id="threading-rules">Threading Rules</h2>
<p>There are a few <strong>threading rules</strong> that must be followed for this class to <strong>work properly</strong>:</p>
<ul>
<li>The <code>AsyncTask</code> class MUST be loaded on the <strong>UI thread</strong>. This is done automatically as of <code>Build.VERSION_CODES.JELLY_BEAN</code>.</li>
<li>The <strong>task instance</strong> MUST be created on the UI thread.</li>
<li><code class="highlight"><span class="nx">execute</span><span class="p">(</span><span class="nx">Params</span><span class="p">...)</span></code> MUST be invoked on the UI thread.</li>
<li>Do NOT call <code class="highlight"><span class="nx">onPreExecute</span><span class="p">()</span></code>, <code class="highlight"><span class="nx">onPostExecute</span><span class="p">(</span><span class="nx">Result</span><span class="p">)</span></code>, <code class="highlight"><span class="nx">doInBackground</span><span class="p">(</span><span class="nx">Params</span><span class="p">...)</span></code>, <code class="highlight"><span class="nx">onProgressUpdate</span><span class="p">(</span><span class="nx">Progress</span><span class="p">...)</span></code> manually.</li>
<li>The task can be <strong>executed only once</strong> (an exception will be thrown if a second execution is attempted.)</li>
</ul>
<h2 id="examples">Examples</h2>
<h3 id="example-1-subclassing-asynctask">Example #1: Subclassing AsyncTask</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScanChannelsTask</span> <span class="kd">extends</span> <span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">JSONObject</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">ScanChannelsTask</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getSimpleName</span><span class="p">();</span>

    <span class="kd">private</span> <span class="n">Context</span> <span class="n">context</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">HttpRequest</span> <span class="n">request</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">running</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Handler</span> <span class="n">handler</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">ScanChannelsTask</span><span class="p">(</span><span class="n">HttpRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">Handler</span> <span class="n">handler</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">request</span> <span class="o">=</span> <span class="n">request</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">handler</span> <span class="o">=</span> <span class="n">handler</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Set the message handler through which the {@link AsyncTask} can communicate with</span>
<span class="cm">     * its main (ie. calling) activity</span>
<span class="cm">     * @param handler</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHandler</span><span class="p">(</span><span class="n">Handler</span> <span class="n">handler</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">handler</span> <span class="o">=</span> <span class="n">handler</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="cm">/**</span>
<span class="cm">     * This method contains the actual task&#39;s logic, ie.,</span>
<span class="cm">     * the computational steps the task is intended to perform.</span>
<span class="cm">     * Here the method takes the TV-Simulator&#39;s IP and command</span>
<span class="cm">     * in form of a {@link String} and performs the HTTP request.     </span>
<span class="cm">     * The result will be passed to a JSON object</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="n">JSONObject</span> <span class="nf">doInBackground</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">params</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">JSONObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">request</span><span class="p">.</span><span class="na">sendHttp</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">obj</span><span class="p">;</span> <span class="c1">// don&#39;t forget to return result for/to onPostExecute()</span>
    <span class="p">}</span>


    <span class="nd">@Override</span>
    <span class="cm">/**</span>
<span class="cm">     * Method is called from the UI thread.</span>
<span class="cm">     * Creates a Toast message to indicate that the task is running</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPreExecute</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">context</span><span class="p">,</span> <span class="s">&quot;Started Channel Scan&quot;</span><span class="p">,</span> <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_SHORT</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="cm">/**</span>
<span class="cm">     * From this method, it is possible to modify the UI</span>
<span class="cm">     * since it is executed in the main UI Thread</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPostExecute</span><span class="p">(</span><span class="n">JSONObject</span> <span class="n">jsonObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">onPostExecute</span><span class="p">(</span><span class="n">jsonObject</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">JSONArray</span> <span class="n">json_channels</span> <span class="o">=</span> <span class="n">jsonObject</span><span class="p">.</span><span class="na">getJSONArray</span><span class="p">(</span><span class="s">&quot;channels&quot;</span><span class="p">);</span>
            <span class="n">JSONObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">JSONObject</span><span class="p">)</span><span class="n">json_channels</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// trying to obtain first channel obj.</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Send data to the activity to have them displayed in the log window   </span>
        <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Message</span><span class="p">();</span>
        <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="p">();</span>
        <span class="n">bundle</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">HANDLER_MESSAGE_KEY</span><span class="p">,</span> <span class="n">jsonObject</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
        <span class="n">msg</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">bundle</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">handler</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
        <span class="n">Toast</span><span class="p">.</span><span class="na">makeText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">context</span><span class="p">,</span> <span class="s">&quot;Channel Scan finished&quot;</span><span class="p">,</span> <span class="n">Toast</span><span class="p">.</span><span class="na">LENGTH_SHORT</span><span class="p">).</span><span class="na">show</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="example-2-passing-runnable-to-asynctasks-execute-method">Example #2: Passing Runnable to AsyncTask&rsquo;s execute Method</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm">* Sends the content from txtCommand widget as command to TV Server</span>
<span class="cm">*</span>
<span class="cm">* Shows Option #2 on instantiating an {@link AsyncTask}</span>
<span class="cm">*</span>
<span class="cm">* {@link AsyncTask}s can also be instantiated by implementing the {@link Runnable} interface</span>
<span class="cm">* (and its run() method) in form of an annonymous inner class that is passed as argument to</span>
<span class="cm">* the {@link AsyncTask}&#39;s execute() method</span>
<span class="cm">*/</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendCommandToTvServer</span><span class="p">(</span><span class="n">View</span> <span class="n">view</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">final</span> <span class="n">String</span> <span class="n">command</span> <span class="o">=</span> <span class="n">txtCommand</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
     <span class="n">txtResponse</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\nSending Command to TV Server: &quot;</span> <span class="o">+</span> <span class="n">command</span><span class="p">);</span>

     <span class="n">AsyncTask</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
               <span class="k">try</span> <span class="p">{</span>
               <span class="n">JSONObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">httpRequest</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
               <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Message</span><span class="p">();</span>
               <span class="n">Bundle</span> <span class="n">bundle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="p">();</span>
               <span class="n">bundle</span><span class="p">.</span><span class="na">putString</span><span class="p">(</span><span class="n">MainActivity</span><span class="p">.</span><span class="na">HANDLER_MESSAGE_KEY</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
               <span class="n">msg</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">bundle</span><span class="p">);</span>
               <span class="cm">/*</span>
<span class="cm">               Example #1</span>
<span class="cm">               SZA: It is important to use sendMessage here;</span>
<span class="cm">               otherwise an Exception is thrown (see Example #3)</span>
<span class="cm">               */</span>
               <span class="n">mMessageHandler</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span> <span class="c1">//</span>
               <span class="cm">/*</span>
<span class="cm">               Example #2</span>
<span class="cm">               Alternatively, view updates can be issued via implementing </span>
<span class="cm">               the Runnable Interface and passing it to the view&#39;s post()-method</span>
<span class="cm">               as an anonymous inner class.</span>
<span class="cm">               That way, UI thread elements can be updated from background threads</span>
<span class="cm">               See https://stackoverflow.com/questions/13840007/what-exactly-does-the-post-method-do </span>
<span class="cm">               */</span>
               <span class="n">txtResponse</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
                         <span class="n">txtResponse</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\nResult created...&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
               <span class="p">})</span> <span class="p">;</span>
               <span class="cm">/*</span>
<span class="cm">               Example #3</span>
<span class="cm">               SZA: Doesn&#39;t work --&gt; Main views can not be modified</span>
<span class="cm">               from runnable objects; only main thread can update its views</span>
<span class="cm">               */</span>
               <span class="c1">// txtResponse.setText(&quot;\n&quot;+ obj.toString());</span>
               <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
               <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
               <span class="p">}</span>
          <span class="p">}</span>
     <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h2 id="what-you-have-learned">What you have Learned</h2>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p><strong>After having finished this lession, you know</strong></p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> &hellip;how to the basic types and callback methods of Android&rsquo;s AsyncTask</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> &hellip;how to implement an AsyncTask for an individual task</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> &hellip;the responsibilities of each callback method</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> &hellip;which callback methods are called by the UI thread and which by the background thread  </li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> &hellip;how to send data from the AsyncTask to the UI thread</li>
</ul>
</div>
<h2 id="disclaimer">Disclaimer</h2>
<p>Most of the information in this lecture has been compiled from the official Android documentation pages:</p>
<ul>
<li><a href="https://developer.android.com/reference/android/os/AsyncTask">https://developer.android.com/reference/android/os/AsyncTask</a></li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../recycler_view/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Zurück
              </span>
              RecyclerView
            </div>
          </div>
        </a>
      
      
        <a href="../thread_communication/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Weiter
              </span>
              Threads & Communication
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "In Zwischenablage kopieren", "clipboard.copied": "In Zwischenablage kopiert", "search.config.lang": "de", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Suche", "search.result.placeholder": "Suchbegriff eingeben", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.term.missing": "Es fehlt"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
        <script src="../javascript/extra.js"></script>
      
    
  </body>
</html>